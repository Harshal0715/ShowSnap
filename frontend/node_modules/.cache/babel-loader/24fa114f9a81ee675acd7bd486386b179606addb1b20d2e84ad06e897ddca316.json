{"ast":null,"code":"// src/components/RazorpayCheckout.js\n\nimport toast from 'react-hot-toast';\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000';\nconst RAZORPAY_KEY = process.env.REACT_APP_RAZORPAY_KEY || 'rzp_test_RIn3HX6YPDL3Nf';\nconst apiFetch = async (endpoint, options = {}) => {\n  const token = localStorage.getItem('token');\n  const res = await fetch(`${API_URL}${endpoint}`, {\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Bearer ${token}`,\n      ...options.headers\n    },\n    ...options\n  });\n  return res.json();\n};\n\n// ✅ Now accepts navigate as a parameter\nconst handleRazorpayPayment = async (payload, setLoading, navigate) => {\n  var _payload$seats, _payload$theater, _payload$theater2;\n  const token = localStorage.getItem('token');\n  const user = JSON.parse(localStorage.getItem('user'));\n  if (!token || !user) {\n    toast.error('User not authenticated. Please log in.');\n    return;\n  }\n  if (!payload || !payload.amount || payload.amount <= 0 || !payload.movieId || !payload.userId || !((_payload$seats = payload.seats) !== null && _payload$seats !== void 0 && _payload$seats.length) || !((_payload$theater = payload.theater) !== null && _payload$theater !== void 0 && _payload$theater.name) || !((_payload$theater2 = payload.theater) !== null && _payload$theater2 !== void 0 && _payload$theater2.location) || !payload.showtimeDate) {\n    toast.error('Incomplete booking details. Please select showtime and seats.');\n    return;\n  }\n  const formattedDate = new Date(payload.showtimeDate).toISOString();\n  try {\n    setLoading === null || setLoading === void 0 ? void 0 : setLoading(true);\n    const {\n      orderId,\n      error: orderError\n    } = await apiFetch('/api/payments/create-order', {\n      method: 'POST',\n      body: JSON.stringify({\n        amount: payload.amount\n      })\n    });\n    if (orderError || !orderId) {\n      toast.error('Failed to create payment order.');\n      setLoading === null || setLoading === void 0 ? void 0 : setLoading(false);\n      return;\n    }\n    if (!window.Razorpay) {\n      toast.error('Razorpay SDK not loaded. Please refresh.');\n      setLoading === null || setLoading === void 0 ? void 0 : setLoading(false);\n      return;\n    }\n    const options = {\n      key: RAZORPAY_KEY,\n      amount: payload.amount,\n      currency: 'INR',\n      name: 'ShowSnap',\n      description: 'Movie Ticket Booking',\n      order_id: orderId,\n      handler: async response => {\n        try {\n          const {\n            razorpay_order_id,\n            razorpay_payment_id,\n            razorpay_signature\n          } = response;\n          if (!razorpay_order_id || !razorpay_payment_id || !razorpay_signature) {\n            toast.error('Incomplete payment response.');\n            return;\n          }\n          const verifyRes = await apiFetch('/api/payments/verify', {\n            method: 'POST',\n            body: JSON.stringify({\n              razorpay_order_id,\n              razorpay_payment_id,\n              razorpay_signature,\n              movieId: payload.movieId,\n              userId: payload.userId,\n              seats: payload.seats,\n              theater: payload.theater,\n              showtimeDate: formattedDate\n            })\n          });\n          if (!verifyRes.success) {\n            toast.error(verifyRes.error || 'Payment verification failed.');\n            return;\n          }\n          toast.success('Booking successful!');\n          // ✅ Use the passed navigate function\n          navigate(`/my-bookings/${verifyRes.bookingId}`);\n        } catch (err) {\n          console.error('Payment handler error:', err);\n          toast.error('Something went wrong during booking.');\n        } finally {\n          setLoading === null || setLoading === void 0 ? void 0 : setLoading(false);\n        }\n      },\n      prefill: {\n        name: user.name || 'Guest',\n        email: user.email || 'guest@example.com',\n        contact: user.contact || '9999999999'\n      },\n      theme: {\n        color: '#F37254'\n      }\n    };\n    new window.Razorpay(options).open();\n  } catch (err) {\n    console.error('Error initiating Razorpay:', err);\n    toast.error('Unable to initiate payment. Please try again.');\n    setLoading === null || setLoading === void 0 ? void 0 : setLoading(false);\n  }\n};\nexport default handleRazorpayPayment;","map":{"version":3,"names":["toast","API_URL","process","env","REACT_APP_API_URL","RAZORPAY_KEY","REACT_APP_RAZORPAY_KEY","apiFetch","endpoint","options","token","localStorage","getItem","res","fetch","headers","Authorization","json","handleRazorpayPayment","payload","setLoading","navigate","_payload$seats","_payload$theater","_payload$theater2","user","JSON","parse","error","amount","movieId","userId","seats","length","theater","name","location","showtimeDate","formattedDate","Date","toISOString","orderId","orderError","method","body","stringify","window","Razorpay","key","currency","description","order_id","handler","response","razorpay_order_id","razorpay_payment_id","razorpay_signature","verifyRes","success","bookingId","err","console","prefill","email","contact","theme","color","open"],"sources":["C:/Users/Harshal/Desktop/showsnap/frontend/src/components/RazorpayCheckout.js"],"sourcesContent":["// src/components/RazorpayCheckout.js\r\n\r\nimport toast from 'react-hot-toast';\r\n\r\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000';\r\nconst RAZORPAY_KEY = process.env.REACT_APP_RAZORPAY_KEY || 'rzp_test_RIn3HX6YPDL3Nf';\r\n\r\nconst apiFetch = async (endpoint, options = {}) => {\r\n    const token = localStorage.getItem('token');\r\n    const res = await fetch(`${API_URL}${endpoint}`, {\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            Authorization: `Bearer ${token}`,\r\n            ...options.headers,\r\n        },\r\n        ...options,\r\n    });\r\n    return res.json();\r\n};\r\n\r\n// ✅ Now accepts navigate as a parameter\r\nconst handleRazorpayPayment = async (payload, setLoading, navigate) => {\r\n    const token = localStorage.getItem('token');\r\n    const user = JSON.parse(localStorage.getItem('user'));\r\n\r\n    if (!token || !user) {\r\n        toast.error('User not authenticated. Please log in.');\r\n        return;\r\n    }\r\n\r\n    if (\r\n        !payload ||\r\n        !payload.amount ||\r\n        payload.amount <= 0 ||\r\n        !payload.movieId ||\r\n        !payload.userId ||\r\n        !payload.seats?.length ||\r\n        !payload.theater?.name ||\r\n        !payload.theater?.location ||\r\n        !payload.showtimeDate\r\n    ) {\r\n        toast.error('Incomplete booking details. Please select showtime and seats.');\r\n        return;\r\n    }\r\n\r\n    const formattedDate = new Date(payload.showtimeDate).toISOString();\r\n\r\n    try {\r\n        setLoading?.(true);\r\n\r\n        const { orderId, error: orderError } = await apiFetch('/api/payments/create-order', {\r\n            method: 'POST',\r\n            body: JSON.stringify({ amount: payload.amount }),\r\n        });\r\n\r\n        if (orderError || !orderId) {\r\n            toast.error('Failed to create payment order.');\r\n            setLoading?.(false);\r\n            return;\r\n        }\r\n\r\n        if (!window.Razorpay) {\r\n            toast.error('Razorpay SDK not loaded. Please refresh.');\r\n            setLoading?.(false);\r\n            return;\r\n        }\r\n\r\n        const options = {\r\n            key: RAZORPAY_KEY,\r\n            amount: payload.amount,\r\n            currency: 'INR',\r\n            name: 'ShowSnap',\r\n            description: 'Movie Ticket Booking',\r\n            order_id: orderId,\r\n            handler: async (response) => {\r\n                try {\r\n                    const { razorpay_order_id, razorpay_payment_id, razorpay_signature } = response;\r\n                    if (!razorpay_order_id || !razorpay_payment_id || !razorpay_signature) {\r\n                        toast.error('Incomplete payment response.');\r\n                        return;\r\n                    }\r\n\r\n                    const verifyRes = await apiFetch('/api/payments/verify', {\r\n                        method: 'POST',\r\n                        body: JSON.stringify({\r\n                            razorpay_order_id,\r\n                            razorpay_payment_id,\r\n                            razorpay_signature,\r\n                            movieId: payload.movieId,\r\n                            userId: payload.userId,\r\n                            seats: payload.seats,\r\n                            theater: payload.theater,\r\n                            showtimeDate: formattedDate,\r\n                        }),\r\n                    });\r\n\r\n                    if (!verifyRes.success) {\r\n                        toast.error(verifyRes.error || 'Payment verification failed.');\r\n                        return;\r\n                    }\r\n\r\n                    toast.success('Booking successful!');\r\n                    // ✅ Use the passed navigate function\r\n                    navigate(`/my-bookings/${verifyRes.bookingId}`); \r\n                } catch (err) {\r\n                    console.error('Payment handler error:', err);\r\n                    toast.error('Something went wrong during booking.');\r\n                } finally {\r\n                    setLoading?.(false);\r\n                }\r\n            },\r\n            prefill: {\r\n                name: user.name || 'Guest',\r\n                email: user.email || 'guest@example.com',\r\n                contact: user.contact || '9999999999',\r\n            },\r\n            theme: { color: '#F37254' },\r\n        };\r\n\r\n        new window.Razorpay(options).open();\r\n    } catch (err) {\r\n        console.error('Error initiating Razorpay:', err);\r\n        toast.error('Unable to initiate payment. Please try again.');\r\n        setLoading?.(false);\r\n    }\r\n};\r\n\r\nexport default handleRazorpayPayment;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}